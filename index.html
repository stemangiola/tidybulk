<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brings transcriptomics to the tidyverse • tidybulk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Brings transcriptomics to the tidyverse">
<meta property="og:description" content="This is a collection of utility functions that allow to perform exploration of and calculations to RNA sequencing data, in a modular, pipe-friendly and tidy fashion.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tidybulk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.17.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/introduction.html">Overview of the tidybulk package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stemangiola/tidybulk/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="tidybulk---part-of-tidytranscriptomics">tidybulk - part of tidyTranscriptomics<a class="anchor" aria-label="anchor" href="#tidybulk---part-of-tidytranscriptomics"></a>
</h1></div>
<!-- badges: start -->

<p><strong>Brings transcriptomics to the tidyverse!</strong></p>
<p>The code is released under the version 3 of the GNU General Public License.</p>
<p><img src="reference/figures/logo.png" width="120px" height="139px"></p>
<p>website: <a href="http://stemangiola.github.io/tidybulk/" class="external-link">stemangiola.github.io/tidybulk/</a> <a href="https://rstudio-pubs-static.s3.amazonaws.com/792462_f948e766b15d4ee5be5c860493bda0b3.html" class="external-link">Third party tutorials</a> Please have a look also to</p>
<ul>
<li>
<a href="https://github.com/stemangiola/tidySummarizedExperiment" class="external-link">tidySummarizedExperiment</a> for bulk data tidy representation</li>
<li>
<a href="https://github.com/stemangiola/tidySingleCellExperiment" class="external-link">tidySingleCellExperiment</a> for single-cell data tidy representation</li>
<li>
<a href="https://github.com/stemangiola/tidyseurat" class="external-link">tidyseurat</a> for single-cell data tidy representation</li>
<li>
<a href="https://github.com/stemangiola/tidyHeatmap" class="external-link">tidyHeatmap</a> for heatmaps produced with tidy principles analysis and manipulation</li>
<li>
<a href="https://github.com/stemangiola/tidygate" class="external-link">tidygate</a> for adding custom gate information to your tibble</li>
</ul>
<!---
&#10;[![Build Status](https://travis-ci.org/stemangiola/tidybulk.svg?branch=master)](https://travis-ci.org/stemangiola/tidybulk) [![Coverage Status](https://coveralls.io/repos/github/stemangiola/tidybulk/badge.svg?branch=master)](https://coveralls.io/github/stemangiola/tidybulk?branch=master)
&#10;--><p><img src="reference/figures/new_SE_usage-01.png" width="800px"></p>
<div class="section level2">
<h2 id="functionsutilities-available">Functions/utilities available<a class="anchor" aria-label="anchor" href="#functionsutilities-available"></a>
</h2>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr>
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>aggregate_duplicates</code></td>
<td>Aggregate abundance and annotation of duplicated transcripts in a robust way</td>
</tr>
<tr>
<td>
<code>identify_abundant</code> <code>keep_abundant</code>
</td>
<td>identify or keep the abundant genes</td>
</tr>
<tr>
<td><code>keep_variable</code></td>
<td>Filter for top variable features</td>
</tr>
<tr>
<td><code>scale_abundance</code></td>
<td>Scale (normalise) abundance for RNA sequencing depth</td>
</tr>
<tr>
<td><code>reduce_dimensions</code></td>
<td>Perform dimensionality reduction (PCA, MDS, tSNE, UMAP)</td>
</tr>
<tr>
<td><code>cluster_elements</code></td>
<td>Labels elements with cluster identity (kmeans, SNN)</td>
</tr>
<tr>
<td><code>remove_redundancy</code></td>
<td>Filter out elements with highly correlated features</td>
</tr>
<tr>
<td><code>adjust_abundance</code></td>
<td>Remove known unwanted variation (Combat)</td>
</tr>
<tr>
<td><code>test_differential_abundance</code></td>
<td>Differential transcript abundance testing (DESeq2, edgeR, voom)</td>
</tr>
<tr>
<td><code>deconvolve_cellularity</code></td>
<td>Estimated tissue composition (Cibersort, llsr, epic, xCell, mcp_counter, quantiseq</td>
</tr>
<tr>
<td><code>test_differential_cellularity</code></td>
<td>Differential cell-type abundance testing</td>
</tr>
<tr>
<td><code>test_stratification_cellularity</code></td>
<td>Estimate Kaplan-Meier survival differences</td>
</tr>
<tr>
<td><code>test_gene_enrichment</code></td>
<td>Gene enrichment analyses (EGSEA)</td>
</tr>
<tr>
<td><code>test_gene_overrepresentation</code></td>
<td>Gene enrichment on list of transcript names (no rank)</td>
</tr>
<tr>
<td><code>test_gene_rank</code></td>
<td>Gene enrichment on list of transcript (GSEA)</td>
</tr>
<tr>
<td><code>impute_missing_abundance</code></td>
<td>Impute abundance for missing data points using sample groupings</td>
</tr>
</tbody>
</table>
<table class="table">
<thead><tr>
<th>Utilities</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>get_bibliography</code></td>
<td>Get the bibliography of your workflow</td>
</tr>
<tr>
<td><code>tidybulk</code></td>
<td>add tidybulk attributes to a tibble object</td>
</tr>
<tr>
<td><code>tidybulk_SAM_BAM</code></td>
<td>Convert SAM BAM files into tidybulk tibble</td>
</tr>
<tr>
<td><code>pivot_sample</code></td>
<td>Select sample-wise columns/information</td>
</tr>
<tr>
<td><code>pivot_transcript</code></td>
<td>Select transcript-wise columns/information</td>
</tr>
<tr>
<td><code>rotate_dimensions</code></td>
<td>Rotate two dimensions of a degree</td>
</tr>
<tr>
<td><code>ensembl_to_symbol</code></td>
<td>Add gene symbol from ensembl IDs</td>
</tr>
<tr>
<td><code>symbol_to_entrez</code></td>
<td>Add entrez ID from gene symbol</td>
</tr>
<tr>
<td><code>describe_transcript</code></td>
<td>Add gene description from gene symbol</td>
</tr>
</tbody>
</table>
<p>All functions are directly compatibble with <code>SummarizedExperiment</code> object.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>From Bioconductor</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"tidybulk"</span><span class="op">)</span></span></code></pre></div>
<p>From Github</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"stemangiola/tidybulk"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h1>
<p>We will use a <code>SummarizedExperiment</code> object</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## [90m# A SummarizedExperiment-tibble abstraction: 408,624 × 8[39m</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## [90m# [90mFeatures=8513 | Samples=48 | Assays=count[0m[39m</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">##    .feature .sample    count Cell.type time  condition batch factor_of_interest</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">##    [3m[90m&lt;chr&gt;[39m[23m    [3m[90m&lt;chr&gt;[39m[23m      [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;lgl&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;lgl&gt;[39m[23m             </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">## [90m 1[39m A1BG     SRR1740034   153 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">## [90m 2[39m A1BG-AS1 SRR1740034    83 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="do">## [90m 3[39m AAAS     SRR1740034   868 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="do">## [90m 4[39m AACS     SRR1740034   222 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="do">## [90m 5[39m AAGAB    SRR1740034   590 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="do">## [90m 6[39m AAMDC    SRR1740034    48 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="do">## [90m 7[39m AAMP     SRR1740034  [4m1[24m257 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="do">## [90m 8[39m AANAT    SRR1740034   284 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="do">## [90m 9[39m AAR2     SRR1740034   379 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="do">## [90m10[39m AARS2    SRR1740034   685 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="do">## [90m# ℹ 40 more rows[39m</span></span></code></pre></div>
<p>Loading <code>tidySummarizedExperiment</code> will automatically abstract this object as <code>tibble</code>, so we can display it and manipulate it with tidy tools. Although it looks different, and more tools (tidyverse) are available to us, this object is in fact a <code>SummarizedExperiment</code> object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">counts_SE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## [1] "SummarizedExperiment"</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">## attr(,"package")</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">## [1] "SummarizedExperiment"</span></span></code></pre></div>
<div class="section level2">
<h2 id="get-the-bibliography-of-your-workflow">Get the bibliography of your workflow<a class="anchor" aria-label="anchor" href="#get-the-bibliography-of-your-workflow"></a>
</h2>
<p>First of all, you can cite all articles utilised within your workflow automatically from any tidybulk tibble</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE</span> <span class="op">|&gt;</span>    <span class="fu"><a href="reference/get_bibliography-methods.html">get_bibliography</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="aggregate-duplicated-transcripts">Aggregate duplicated <code>transcripts</code>
<a class="anchor" aria-label="anchor" href="#aggregate-duplicated-transcripts"></a>
</h2>
<p>tidybulk provide the <code>aggregate_duplicates</code> function to aggregate duplicated transcripts (e.g., isoforms, ensembl). For example, we often have to convert ensembl symbols to gene/transcript symbol, but in doing so we have to deal with duplicates. <code>aggregate_duplicates</code> takes a tibble and column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) as arguments and returns a tibble with transcripts with the same name aggregated. All the rest of the columns are appended, and factors and boolean are appended as characters.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rowData</span><span class="op">(</span><span class="va">counts_SE</span><span class="op">)</span><span class="op">$</span><span class="va">gene_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">counts_SE</span><span class="op">)</span></span>
<span><span class="va">counts_SE.aggr</span> <span class="op">=</span> <span class="va">counts_SE</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/aggregate_duplicates-methods.html">aggregate_duplicates</a></span><span class="op">(</span>.transcript <span class="op">=</span> <span class="va">gene_name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    symbol <span class="op">=</span> <span class="va">dge_list</span><span class="op">$</span><span class="va">genes</span><span class="op">$</span><span class="va">symbol</span>,</span>
<span>    <span class="va">dge_list</span><span class="op">$</span><span class="va">counts</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dge_list.nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">temp</span><span class="op">$</span><span class="va">symbol</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span>            <span class="fu">matrixStats</span><span class="fu">:::</span><span class="fu">colSums</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dge_list.nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">dge_list.nr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dge_list.nr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dge_list</span><span class="op">)</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
</div>
<div class="section level2">
<h2 id="scale-counts">Scale <code>counts</code>
<a class="anchor" aria-label="anchor" href="#scale-counts"></a>
</h2>
<p>We may want to compensate for sequencing depth, scaling the transcript abundance (e.g., with TMM algorithm, Robinson and Oshlack doi.org/10.1186/gb-2010-11-3-r25). <code>scale_abundance</code> takes a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and a method as arguments and returns a tibble with additional columns with scaled data as <code>&lt;NAME OF COUNT COLUMN&gt;_scaled</code>.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm</span> <span class="op">=</span> <span class="va">counts_SE.aggr</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/identify_abundant-methods.html">identify_abundant</a></span><span class="op">(</span>factor_of_interest <span class="op">=</span> <span class="va">condition</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/scale_abundance-methods.html">scale_abundance</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="do">## tidybulk says: the sample with largest library size SRR1740080 was chosen as reference for scaling</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(edgeR)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>dgList <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(<span class="at">count_m=</span>x,<span class="at">group=</span>group)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">filterByExpr</span>(dgList)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>dgList <span class="ot">&lt;-</span> dgList[keep,,keep.lib.sizes<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>[...]</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>dgList <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(dgList, <span class="at">method=</span><span class="st">"TMM"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>norm_counts.table <span class="ot">&lt;-</span> <span class="fu">cpm</span>(dgList)</span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>We can easily plot the scaled density to check the scaling outcome. On the x axis we have the log scaled counts, on the y axes we have the density, data is grouped by sample and coloured by cell type.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">count_scaled</span> <span class="op">+</span> <span class="fl">1</span>, group<span class="op">=</span><span class="va">.sample</span>, color<span class="op">=</span><span class="va">`Cell.type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/plot_normalise-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="filter-variable-transcripts">Filter <code>variable transcripts</code>
<a class="anchor" aria-label="anchor" href="#filter-variable-transcripts"></a>
</h2>
<p>We may want to identify and filter variable transcripts.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.variable</span> <span class="op">=</span> <span class="va">counts_SE.norm</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/keep_variable-methods.html">keep_variable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## Getting the 500 most variable genes</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/edgeR/" class="external-link">edgeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="va">norm_counts.table</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">s</span>,decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">o</span><span class="op">[</span><span class="fl">1L</span><span class="op">:</span><span class="va">top</span><span class="op">]</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="va">norm_counts.table</span> <span class="op">=</span> <span class="va">norm_counts.table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">norm_counts.table</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">tibble_counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span></span>
<span>        <span class="va">tibble_counts</span><span class="op">$</span><span class="va">sample</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">norm_counts.table</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="st">"Cell.type"</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
</div>
<div class="section level2">
<h2 id="reduce-dimensions">Reduce <code>dimensions</code>
<a class="anchor" aria-label="anchor" href="#reduce-dimensions"></a>
</h2>
<p>We may want to reduce the dimensions of our data, for example using PCA or MDS algorithms. <code>reduce_dimensions</code> takes a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and a method (e.g., MDS or PCA) as arguments and returns a tibble with additional columns for the reduced dimensions.</p>
<p><strong>MDS</strong> (Robinson et al., 10.1093/bioinformatics/btp616)</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.MDS</span> <span class="op">=</span></span>
<span>  <span class="va">counts_SE.norm</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/reduce_dimensions-methods.html">reduce_dimensions</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"MDS"</span>, .dims <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="do">## Getting the 500 most variable genes</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="do">## tidybulk says: to access the raw results do `attr(..., "internals")$MDS`</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/limma/" class="external-link">limma</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_m_log</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">count_m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cmds</span> <span class="op">=</span> <span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/plotMDS.html" class="external-link">plotMDS</a></span><span class="op">(</span>ndim <span class="op">=</span> <span class="va">.dims</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cmds</span> <span class="op">=</span> <span class="va">cmds</span> <span class="op">%$%</span> </span>
<span>    <span class="va">cmdscale.out</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Dim%s"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cmds</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">tibble_counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">tibble_counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cmds</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"Cell.type"</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>On the x and y axes axis we have the reduced dimensions 1 to 3, data is coloured by cell type.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.MDS</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"Dim"</span><span class="op">)</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 48 × 14[39m</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="do">##      Dim1   Dim2   Dim3     Dim4    Dim5    Dim6 .sample    Cell.type      time </span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="do">##     [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m   [3m[90m&lt;dbl&gt;[39m[23m   [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m      [3m[90m&lt;fct&gt;[39m[23m          [3m[90m&lt;fct&gt;[39m[23m</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="do">## [90m 1[39m -[31m1[39m[31m.[39m[31m46[39m   0.220 -[31m1[39m[31m.[39m[31m68[39m   0.055[4m3[24m   0.065[4m8[24m -[31m0[39m[31m.[39m[31m126[39m  SRR1740034 b_cell         0 d  </span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="do">## [90m 2[39m -[31m1[39m[31m.[39m[31m46[39m   0.226 -[31m1[39m[31m.[39m[31m71[39m   0.030[4m0[24m   0.045[4m4[24m -[31m0[39m[31m.[39m[31m137[39m  SRR1740035 b_cell         1 d  </span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="do">## [90m 3[39m -[31m1[39m[31m.[39m[31m44[39m   0.193 -[31m1[39m[31m.[39m[31m60[39m   0.089[4m0[24m   0.050[4m3[24m -[31m0[39m[31m.[39m[31m121[39m  SRR1740036 b_cell         3 d  </span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="do">## [90m 4[39m -[31m1[39m[31m.[39m[31m44[39m   0.198 -[31m1[39m[31m.[39m[31m67[39m   0.089[4m1[24m   0.054[4m3[24m -[31m0[39m[31m.[39m[31m110[39m  SRR1740037 b_cell         7 d  </span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="do">## [90m 5[39m  0.243 -[31m1[39m[31m.[39m[31m42[39m   0.182  0.006[4m4[24m[4m2[24m -[31m0[39m[31m.[39m[31m503[39m  -[31m0[39m[31m.[39m[31m131[39m  SRR1740038 dendritic_mye… 0 d  </span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="do">## [90m 6[39m  0.191 -[31m1[39m[31m.[39m[31m42[39m   0.195  0.018[4m0[24m  -[31m0[39m[31m.[39m[31m457[39m  -[31m0[39m[31m.[39m[31m130[39m  SRR1740039 dendritic_mye… 1 d  </span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="do">## [90m 7[39m  0.257 -[31m1[39m[31m.[39m[31m42[39m   0.152  0.013[4m0[24m  -[31m0[39m[31m.[39m[31m582[39m  -[31m0[39m[31m.[39m[31m0[39m[31m92[4m7[24m[39m SRR1740040 dendritic_mye… 3 d  </span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="do">## [90m 8[39m  0.162 -[31m1[39m[31m.[39m[31m43[39m   0.189  0.023[4m2[24m  -[31m0[39m[31m.[39m[31m452[39m  -[31m0[39m[31m.[39m[31m109[39m  SRR1740041 dendritic_mye… 7 d  </span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="do">## [90m 9[39m  0.516 -[31m1[39m[31m.[39m[31m47[39m   0.240 -[31m0[39m[31m.[39m[31m251[39m    0.457  -[31m0[39m[31m.[39m[31m119[39m  SRR1740042 monocyte       0 d  </span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="do">## [90m10[39m  0.514 -[31m1[39m[31m.[39m[31m41[39m   0.231 -[31m0[39m[31m.[39m[31m219[39m    0.458  -[31m0[39m[31m.[39m[31m131[39m  SRR1740043 monocyte       1 d  </span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="do">## [90m# ℹ 38 more rows[39m</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="do">## [90m# ℹ 5 more variables: condition &lt;lgl&gt;, batch &lt;fct&gt;, factor_of_interest &lt;lgl&gt;,[39m</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="do">## [90m#   TMM &lt;dbl&gt;, multiplier &lt;dbl&gt;[39m</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.MDS</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="op">(</span><span class="fl">6</span><span class="op">+</span><span class="fl">5</span><span class="op">)</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">`Cell.type`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="do">## Registered S3 method overwritten by 'GGally':</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="do">##   method from   </span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="do">##   +.gg   ggplot2</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="do">## [1m[22m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="do">## [1m[22m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="do">## [1m[22m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="do">## [1m[22m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="do">## [1m[22m`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="reference/figures/plot_mds-1.png"><!-- --></p>
<p><strong>PCA</strong></p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.PCA</span> <span class="op">=</span></span>
<span>  <span class="va">counts_SE.norm</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/reduce_dimensions-methods.html">reduce_dimensions</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"PCA"</span>, .dims <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_m_log</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">count_m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pc</span> <span class="op">=</span> <span class="va">count_m_log</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">variance</span> <span class="op">=</span> <span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">variance</span> <span class="op">=</span> <span class="op">(</span><span class="va">variance</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">variance</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="va">pc</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">pc</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"Cell.type"</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>On the x and y axes axis we have the reduced dimensions 1 to 3, data is coloured by cell type.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.PCA</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 48 × 14[39m</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="do">##        PC1   PC2    PC3     PC4    PC5   PC6 .sample   Cell.type time  condition</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="do">##      [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m   [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;lgl&gt;[39m[23m    </span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="do">## [90m 1[39m -[31m12[39m[31m.[39m[31m6[39m   -[31m2[39m[31m.[39m[31m52[39m -[31m14[39m[31m.[39m[31m9[39m  -[31m0[39m[31m.[39m[31m424[39m  -[31m0[39m[31m.[39m[31m592[39m -[31m1[39m[31m.[39m[31m22[39m SRR17400… b_cell    0 d   TRUE     </span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="do">## [90m 2[39m -[31m12[39m[31m.[39m[31m6[39m   -[31m2[39m[31m.[39m[31m57[39m -[31m15[39m[31m.[39m[31m2[39m  -[31m0[39m[31m.[39m[31m140[39m  -[31m0[39m[31m.[39m[31m388[39m -[31m1[39m[31m.[39m[31m30[39m SRR17400… b_cell    1 d   TRUE     </span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="do">## [90m 3[39m -[31m12[39m[31m.[39m[31m6[39m   -[31m2[39m[31m.[39m[31m41[39m -[31m14[39m[31m.[39m[31m5[39m  -[31m0[39m[31m.[39m[31m714[39m  -[31m0[39m[31m.[39m[31m344[39m -[31m1[39m[31m.[39m[31m10[39m SRR17400… b_cell    3 d   TRUE     </span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="do">## [90m 4[39m -[31m12[39m[31m.[39m[31m5[39m   -[31m2[39m[31m.[39m[31m34[39m -[31m14[39m[31m.[39m[31m9[39m  -[31m0[39m[31m.[39m[31m816[39m  -[31m0[39m[31m.[39m[31m427[39m -[31m1[39m[31m.[39m[31m00[39m SRR17400… b_cell    7 d   TRUE     </span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="do">## [90m 5[39m   0.189 13.0    1.66 -[31m0[39m[31m.[39m[31m0[39m[31m26[4m9[24m[39m  4.64  -[31m1[39m[31m.[39m[31m35[39m SRR17400… dendriti… 0 d   FALSE    </span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="do">## [90m 6[39m  -[31m0[39m[31m.[39m[31m293[39m 12.9    1.76 -[31m0[39m[31m.[39m[31m0[39m[31m72[4m7[24m[39m  4.21  -[31m1[39m[31m.[39m[31m28[39m SRR17400… dendriti… 1 d   FALSE    </span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="do">## [90m 7[39m   0.407 13.0    1.42 -[31m0[39m[31m.[39m[31m0[39m[31m52[4m9[24m[39m  5.37  -[31m1[39m[31m.[39m[31m0[39m[31m1[39m SRR17400… dendriti… 3 d   FALSE    </span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="do">## [90m 8[39m  -[31m0[39m[31m.[39m[31m620[39m 13.0    1.73 -[31m0[39m[31m.[39m[31m201[39m   4.17  -[31m1[39m[31m.[39m[31m0[39m[31m7[39m SRR17400… dendriti… 7 d   FALSE    </span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="do">## [90m 9[39m   2.56  13.5    2.32  2.03   -[31m4[39m[31m.[39m[31m32[39m  -[31m1[39m[31m.[39m[31m22[39m SRR17400… monocyte  0 d   FALSE    </span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="do">## [90m10[39m   2.65  13.1    2.21  1.80   -[31m4[39m[31m.[39m[31m29[39m  -[31m1[39m[31m.[39m[31m30[39m SRR17400… monocyte  1 d   FALSE    </span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="do">## [90m# ℹ 38 more rows[39m</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="do">## [90m# ℹ 4 more variables: batch &lt;fct&gt;, factor_of_interest &lt;lgl&gt;, TMM &lt;dbl&gt;,[39m</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="do">## [90m#   multiplier &lt;dbl&gt;[39m</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.PCA</span> <span class="op">|&gt;</span></span>
<span>     <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">13</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">`Cell.type`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/plot_pca-1.png"><!-- --></p>
<p><strong>tSNE</strong></p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.tSNE</span> <span class="op">=</span></span>
<span>    <span class="va">breast_tcga_mini_SE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/identify_abundant-methods.html">identify_abundant</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/reduce_dimensions-methods.html">reduce_dimensions</a></span><span class="op">(</span></span>
<span>        method <span class="op">=</span> <span class="st">"tSNE"</span>,</span>
<span>        perplexity<span class="op">=</span><span class="fl">10</span>,</span>
<span>        pca_scale <span class="op">=</span><span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_m_log</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">count_m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tsne</span> <span class="op">=</span> <span class="fu">Rtsne</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rtsne/man/Rtsne.html" class="external-link">Rtsne</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">count_m_log</span><span class="op">)</span>,</span>
<span>    perplexity<span class="op">=</span><span class="fl">10</span>,</span>
<span>        pca_scale <span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">Y</span></span>
<span><span class="va">tsne</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">tibble_counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">tibble_counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">tsne</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"Cell.type"</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>Plot</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.tSNE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"tSNE"</span><span class="op">)</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 251 × 4[39m</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="do">##      tSNE1  tSNE2 .sample                      Call </span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="do">##      [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m                        [3m[90m&lt;fct&gt;[39m[23m</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="do">## [90m 1[39m  -[31m9[39m[31m.[39m[31m0[39m[31m8[39m   -[31m4[39m[31m.[39m[31m37[39m TCGA-A1-A0SD-01A-11R-A115-07 LumA </span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="do">## [90m 2[39m   0.739   9.67 TCGA-A1-A0SF-01A-11R-A144-07 LumA </span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="do">## [90m 3[39m -[31m20[39m[31m.[39m[31m2[39m    -[31m4[39m[31m.[39m[31m56[39m TCGA-A1-A0SG-01A-11R-A144-07 LumA </span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="do">## [90m 4[39m  -[31m1[39m[31m.[39m[31m0[39m[31m9[39m   -[31m1[39m[31m.[39m[31m0[39m[31m2[39m TCGA-A1-A0SH-01A-11R-A084-07 LumA </span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="do">## [90m 5[39m  -[31m5[39m[31m.[39m[31m0[39m[31m2[39m   -[31m1[39m[31m.[39m[31m0[39m[31m6[39m TCGA-A1-A0SI-01A-11R-A144-07 LumB </span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="do">## [90m 6[39m   2.23    2.85 TCGA-A1-A0SJ-01A-11R-A084-07 LumA </span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="do">## [90m 7[39m  30.0    17.2  TCGA-A1-A0SK-01A-12R-A084-07 Basal</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="do">## [90m 8[39m   7.12   -[31m2[39m[31m.[39m[31m29[39m TCGA-A1-A0SM-01A-11R-A084-07 LumA </span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a><span class="do">## [90m 9[39m   6.11   -[31m3[39m[31m.[39m[31m15[39m TCGA-A1-A0SN-01A-11R-A144-07 LumB </span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="do">## [90m10[39m -[31m17[39m[31m.[39m[31m8[39m   -[31m11[39m[31m.[39m[31m8[39m  TCGA-A1-A0SQ-01A-21R-A144-07 LumA </span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="do">## [90m# ℹ 241 more rows[39m</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.tSNE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">`tSNE1`</span>, y <span class="op">=</span> <span class="va">`tSNE2`</span>, color<span class="op">=</span><span class="va">Call</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-14-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="rotate-dimensions">Rotate <code>dimensions</code>
<a class="anchor" aria-label="anchor" href="#rotate-dimensions"></a>
</h2>
<p>We may want to rotate the reduced dimensions (or any two numeric columns really) of our data, of a set angle. <code>rotate_dimensions</code> takes a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and an angle as arguments and returns a tibble with additional columns for the rotated dimensions. The rotated dimensions will be added to the original data set as <code>&lt;NAME OF DIMENSION&gt; rotated &lt;ANGLE&gt;</code> by default, or as specified in the input arguments.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.MDS.rotated</span> <span class="op">=</span></span>
<span>  <span class="va">counts_SE.norm.MDS</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/rotate_dimensions-methods.html">rotate_dimensions</a></span><span class="op">(</span><span class="va">`Dim1`</span>, <span class="va">`Dim2`</span>, rotation_degrees <span class="op">=</span> <span class="fl">45</span>, action<span class="op">=</span><span class="st">"get"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rotation</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">r</span> <span class="op">=</span> <span class="va">d</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="fu"><a href="reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`1` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, `2` <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`1` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, `2` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/as_matrix.html">as_matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mds_r</span> <span class="op">=</span> <span class="va">pca</span> <span class="op">|&gt;</span> <span class="fu">rotation</span><span class="op">(</span><span class="va">rotation_degrees</span><span class="op">)</span></span>
<span><span class="va">mds_r</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mds_r</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"Cell.type"</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p><strong>Original</strong> On the x and y axes axis we have the first two reduced dimensions, data is coloured by cell type.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.MDS.rotated</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">`Dim1`</span>, y<span class="op">=</span><span class="va">`Dim2`</span>, color<span class="op">=</span><span class="va">`Cell.type`</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/plot_rotate_1-1.png"><!-- --></p>
<p><strong>Rotated</strong> On the x and y axes axis we have the first two reduced dimensions rotated of 45 degrees, data is coloured by cell type.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.MDS.rotated</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">`Dim1_rotated_45`</span>, y<span class="op">=</span><span class="va">`Dim2_rotated_45`</span>, color<span class="op">=</span><span class="va">`Cell.type`</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/plot_rotate_2-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="test-differential-abundance">Test <code>differential abundance</code>
<a class="anchor" aria-label="anchor" href="#test-differential-abundance"></a>
</h2>
<p>We may want to test for differential transcription between sample-wise factors of interest (e.g., with edgeR). <code>test_differential_abundance</code> takes a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and a formula representing the desired linear model as arguments and returns a tibble with additional columns for the statistics from the hypothesis test (e.g., log fold change, p-value and false discovery rate).</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.de</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/test_differential_abundance-methods.html">test_differential_abundance</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">condition</span>, action<span class="op">=</span><span class="st">"get"</span><span class="op">)</span></span>
<span><span class="va">counts_SE.de</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/edgeR/" class="external-link">edgeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dgList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/DGEList.html" class="external-link">DGEList</a></span><span class="op">(</span>counts<span class="op">=</span><span class="va">counts_m</span>,group<span class="op">=</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/filterByExpr.html" class="external-link">filterByExpr</a></span><span class="op">(</span><span class="va">dgList</span><span class="op">)</span></span>
<span><span class="va">dgList</span> <span class="op">&lt;-</span> <span class="va">dgList</span><span class="op">[</span><span class="va">keep</span>,,keep.lib.sizes<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">dgList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/calcNormFactors.html" class="external-link">calcNormFactors</a></span><span class="op">(</span><span class="va">dgList</span><span class="op">)</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="va">dgList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/estimateDisp.html" class="external-link">estimateDisp</a></span><span class="op">(</span><span class="va">dgList</span>,<span class="va">design</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/glmQLFit.html" class="external-link">glmQLFit</a></span><span class="op">(</span><span class="va">dgList</span>,<span class="va">design</span><span class="op">)</span></span>
<span><span class="va">qlf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/glmQLFTest.html" class="external-link">glmQLFTest</a></span><span class="op">(</span><span class="va">fit</span>,coef<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/topTags.html" class="external-link">topTags</a></span><span class="op">(</span><span class="va">qlf</span>, n<span class="op">=</span><span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>The functon <code>test_differential_abundance</code> operated with contrasts too. The constrasts hve the name of the design matrix (generally <name_column_covariate><values_of_covariate>)</values_of_covariate></name_column_covariate></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.de</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/identify_abundant-methods.html">identify_abundant</a></span><span class="op">(</span>factor_of_interest <span class="op">=</span> <span class="va">condition</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/test_differential_abundance-methods.html">test_differential_abundance</a></span><span class="op">(</span></span>
<span>        <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">condition</span>,                  </span>
<span>        .contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"conditionTRUE - conditionFALSE"</span><span class="op">)</span>,</span>
<span>        action<span class="op">=</span><span class="st">"get"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjust-counts">Adjust <code>counts</code>
<a class="anchor" aria-label="anchor" href="#adjust-counts"></a>
</h2>
<p>We may want to adjust <code>counts</code> for (known) unwanted variation. <code>adjust_abundance</code> takes as arguments a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and a formula representing the desired linear model where the first covariate is the factor of interest and the second covariate is the unwanted variation, and returns a tibble with additional columns for the adjusted counts as <code>&lt;COUNT COLUMN&gt;_adjusted</code>. At the moment just an unwanted covariated is allowed at a time.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.adj</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE.norm</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/adjust_abundance-methods.html">adjust_abundance</a></span><span class="op">(</span> .factor_unwanted <span class="op">=</span> <span class="va">batch</span>, .factor_of_interest <span class="op">=</span> <span class="va">factor_of_interest</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sva</span><span class="op">)</span></span>
<span></span>
<span><span class="va">count_m_log</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">count_m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design</span> <span class="op">=</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>            object <span class="op">=</span> <span class="op">~</span> <span class="va">factor_of_interest</span> <span class="op">+</span> <span class="va">batch</span>,</span>
<span>            data <span class="op">=</span> <span class="va">annotation</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="va">count_m_log.sva</span> <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/sva/man/ComBat.html" class="external-link">ComBat</a></span><span class="op">(</span></span>
<span>            batch <span class="op">=</span> <span class="va">design</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>            mod <span class="op">=</span> <span class="va">design</span>,</span>
<span>            <span class="va">...</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="va">count_m_log.sva</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">count_m_log.sva</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">count_m_log.sva</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">count_m_log.sva</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"Cell.type"</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
</div>
<div class="section level2">
<h2 id="deconvolve-cell-type-composition">Deconvolve <code>Cell type composition</code>
<a class="anchor" aria-label="anchor" href="#deconvolve-cell-type-composition"></a>
</h2>
<p>We may want to infer the cell type composition of our samples (with the algorithm Cibersort; Newman et al., 10.1038/nmeth.3337). <code>deconvolve_cellularity</code> takes as arguments a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and returns a tibble with additional columns for the adjusted cell type proportions.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.cibersort</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/deconvolve_cellularity-methods.html">deconvolve_cellularity</a></span><span class="op">(</span>action<span class="op">=</span><span class="st">"get"</span>, cores<span class="op">=</span><span class="fl">1</span>, prefix <span class="op">=</span> <span class="st">"cibersort__"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">source</span>(‘CIBERSORT.R’)</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>count_m <span class="sc">|&gt;</span> <span class="fu">write.table</span>(<span class="st">"mixture_file.txt"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">CIBERSORT</span>(</span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>    <span class="st">"sig_matrix_file.txt"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>    <span class="st">"mixture_file.txt"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>    <span class="at">perm=</span><span class="dv">100</span>, <span class="at">QN=</span><span class="cn">TRUE</span></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a>)</span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>results<span class="sc">$</span>cell_type <span class="ot">=</span> tibble_counts[</span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>    <span class="fu">match</span>(tibble_counts<span class="sc">$</span>sample, <span class="fu">rownames</span>(results)),</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>    <span class="st">"Cell.type"</span></span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>With the new annotated data frame, we can plot the distributions of cell types across samples, and compare them with the nominal cell type labels to check for the purity of isolation. On the x axis we have the cell types inferred by Cibersort, on the y axis we have the inferred proportions. The data is facetted and coloured by nominal cell types (annotation given by the researcher after FACS sorting).</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.cibersort</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>        names_to<span class="op">=</span> <span class="st">"Cell_type_inferred"</span>, </span>
<span>        values_to <span class="op">=</span> <span class="st">"proportion"</span>, </span>
<span>        names_prefix <span class="op">=</span><span class="st">"cibersort__"</span>, </span>
<span>        cols<span class="op">=</span><span class="fu">contains</span><span class="op">(</span><span class="st">"cibersort__"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">`Cell_type_inferred`</span>, y<span class="op">=</span><span class="va">proportion</span>, fill<span class="op">=</span><span class="va">`Cell.type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">`Cell.type`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">my_theme</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, aspect.ratio<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="do">## tidySummarizedExperiment says: A data frame is returned for independent data analysis.</span></span></code></pre></div>
<p><img src="reference/figures/plot_cibersort-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="test-differential-cell-type-abundance">Test differential cell-type abundance<a class="anchor" aria-label="anchor" href="#test-differential-cell-type-abundance"></a>
</h2>
<p>We can also perform a statistical test on the differential cell-type abundance across conditions</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">counts_SE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/test_differential_cellularity-methods.html">test_differential_cellularity</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">condition</span> <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 22 × 7[39m</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="do">##    .cell_type                       cell_type_proportions `estimate_(Intercept)`</span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="do">##    [3m[90m&lt;chr&gt;[39m[23m                            [3m[90m&lt;list&gt;[39m[23m                                 [3m[90m&lt;dbl&gt;[39m[23m</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="do">## [90m 1[39m cibersort.B.cells.naive          [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m2[39m[31m.[39m[31m94[39m</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a><span class="do">## [90m 2[39m cibersort.B.cells.memory         [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m4[39m[31m.[39m[31m86[39m</span></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a><span class="do">## [90m 3[39m cibersort.Plasma.cells           [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m5[39m[31m.[39m[31m33[39m</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="do">## [90m 4[39m cibersort.T.cells.CD8            [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m2[39m[31m.[39m[31m33[39m</span></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a><span class="do">## [90m 5[39m cibersort.T.cells.CD4.naive      [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m2[39m[31m.[39m[31m83[39m</span></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a><span class="do">## [90m 6[39m cibersort.T.cells.CD4.memory.re… [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m2[39m[31m.[39m[31m46[39m</span></span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a><span class="do">## [90m 7[39m cibersort.T.cells.CD4.memory.ac… [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m3[39m[31m.[39m[31m67[39m</span></span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a><span class="do">## [90m 8[39m cibersort.T.cells.follicular.he… [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m5[39m[31m.[39m[31m68[39m</span></span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a><span class="do">## [90m 9[39m cibersort.T.cells.regulatory..T… [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m5[39m[31m.[39m[31m0[39m[31m4[39m</span></span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a><span class="do">## [90m10[39m cibersort.T.cells.gamma.delta    [90m&lt;tibble [48 × 8]&gt;[39m                      -[31m4[39m[31m.[39m[31m78[39m</span></span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a><span class="do">## [90m# ℹ 12 more rows[39m</span></span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a><span class="do">## [90m# ℹ 4 more variables: estimate_conditionTRUE &lt;dbl&gt;,[39m</span></span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a><span class="do">## [90m#   std.error_conditionTRUE &lt;dbl&gt;, statistic_conditionTRUE &lt;dbl&gt;,[39m</span></span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a><span class="do">## [90m#   p.value_conditionTRUE &lt;dbl&gt;[39m</span></span></code></pre></div>
<p>We can also perform regression analysis with censored data (coxph).</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="co"># Add survival data</span></span>
<span></span>
<span><span class="va">counts_SE_survival</span> <span class="op">=</span> </span>
<span>    <span class="va">counts_SE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/nest-methods.html">nest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="op">-</span><span class="va">sample</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="reference/mutate-methods.html">mutate</a></span><span class="op">(</span></span>
<span>            days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, size <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            dead <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/nest-methods.html">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="do">## Warning in is_sample_feature_deprecated_used(.data, .cols):</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="do">## tidySummarizedExperiment says: from version 1.3.1, the special columns</span></span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a><span class="do">## including sample/feature id (colnames(se), rownames(se)) has changed to</span></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="do">## ".sample" and ".feature". This dataset is returned with the old-style</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a><span class="do">## vocabulary (feature and sample), however we suggest to update your workflow to</span></span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a><span class="do">## reflect the new vocabulary (.feature, .sample)</span></span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a><span class="do">## Warning in is_sample_feature_deprecated_used(.data, .cols):</span></span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a><span class="do">## tidySummarizedExperiment says: from version 1.3.1, the special columns</span></span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a><span class="do">## including sample/feature id (colnames(se), rownames(se)) has changed to</span></span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a><span class="do">## ".sample" and ".feature". This dataset is returned with the old-style</span></span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a><span class="do">## vocabulary (feature and sample), however we suggest to update your workflow to</span></span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a><span class="do">## reflect the new vocabulary (.feature, .sample)</span></span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a><span class="do">## Warning: [1m[22mThere were 96 warnings in `mutate()`.</span></span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a><span class="do">## The first warning was:</span></span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a><span class="do">## [1m[22m[36mℹ[39m In argument: `data = map2(...)`.</span></span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a><span class="do">## Caused by warning in `is_sample_feature_deprecated_used()`:</span></span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a><span class="do">## [33m![39m tidySummarizedExperiment says: from version 1.3.1, the special columns including sample/feature id (colnames(se), rownames(se)) has changed to ".sample" and ".feature". This dataset is returned with the old-style vocabulary (feature and sample), however we suggest to update your workflow to reflect the new vocabulary (.feature, .sample)</span></span>
<span id="cb50-19"><a href="#cb50-19" tabindex="-1"></a><span class="do">## [1m[22m[36mℹ[39m Run `dplyr::last_dplyr_warnings()` to see the 95 remaining warnings.</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test</span></span>
<span><span class="va">counts_SE_survival</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/test_differential_cellularity-methods.html">test_differential_cellularity</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">dead</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 22 × 6[39m</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="do">##    .cell_type         cell_type_proportions estimate std.error statistic p.value</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="do">##    [3m[90m&lt;chr&gt;[39m[23m              [3m[90m&lt;list&gt;[39m[23m                   [3m[90m&lt;dbl&gt;[39m[23m     [3m[90m&lt;dbl&gt;[39m[23m     [3m[90m&lt;dbl&gt;[39m[23m   [3m[90m&lt;dbl&gt;[39m[23m</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a><span class="do">## [90m 1[39m cibersort.B.cells… [90m&lt;tibble [48 × 9]&gt;[39m        3.57      1.29      2.77  0.005[4m6[24m[4m5[24m</span></span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a><span class="do">## [90m 2[39m cibersort.B.cells… [90m&lt;tibble [48 × 9]&gt;[39m       -[31m0[39m[31m.[39m[31m333[39m     0.523    -[31m0[39m[31m.[39m[31m638[39m 0.524  </span></span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a><span class="do">## [90m 3[39m cibersort.Plasma.… [90m&lt;tibble [48 × 9]&gt;[39m        0.269     0.538     0.499 0.618  </span></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a><span class="do">## [90m 4[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m        5.10      2.95      1.73  0.083[4m5[24m </span></span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a><span class="do">## [90m 5[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m        4.66      1.88      2.47  0.013[4m5[24m </span></span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a><span class="do">## [90m 6[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m        0.994     1.23      0.811 0.418  </span></span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a><span class="do">## [90m 7[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m        1.12      1.45      0.772 0.440  </span></span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a><span class="do">## [90m 8[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m        2.02      0.755     2.67  0.007[4m5[24m[4m6[24m</span></span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a><span class="do">## [90m 9[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m        0.455     1.01      0.451 0.652  </span></span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a><span class="do">## [90m10[39m cibersort.T.cells… [90m&lt;tibble [48 × 9]&gt;[39m       10.9       4.86      2.23  0.025[4m6[24m </span></span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a><span class="do">## [90m# ℹ 12 more rows[39m</span></span></code></pre></div>
<p>We can also perform test of Kaplan-Meier curves.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_stratified</span> <span class="op">=</span> </span>
<span>    <span class="va">counts_SE_survival</span> <span class="op">|&gt;</span></span>
<span></span>
<span>    <span class="co"># Test</span></span>
<span>    <span class="fu"><a href="reference/test_stratification_cellularity-methods.html">test_stratification_cellularity</a></span><span class="op">(</span></span>
<span>        <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">dead</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>        <span class="va">sample</span>, <span class="va">transcript</span>, <span class="va">count</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">counts_stratified</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 22 × 6[39m</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="do">##    .cell_type                       cell_type_proportions .low_cellularity_exp…¹</span></span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a><span class="do">##    [3m[90m&lt;chr&gt;[39m[23m                            [3m[90m&lt;list&gt;[39m[23m                                 [3m[90m&lt;dbl&gt;[39m[23m</span></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a><span class="do">## [90m 1[39m cibersort.B.cells.naive          [90m&lt;tibble [48 × 9]&gt;[39m                       8.77</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a><span class="do">## [90m 2[39m cibersort.B.cells.memory         [90m&lt;tibble [48 × 9]&gt;[39m                      10.6 </span></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a><span class="do">## [90m 3[39m cibersort.Plasma.cells           [90m&lt;tibble [48 × 9]&gt;[39m                      13.2 </span></span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a><span class="do">## [90m 4[39m cibersort.T.cells.CD8            [90m&lt;tibble [48 × 9]&gt;[39m                       9.32</span></span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a><span class="do">## [90m 5[39m cibersort.T.cells.CD4.naive      [90m&lt;tibble [48 × 9]&gt;[39m                      12.3 </span></span>
<span id="cb54-9"><a href="#cb54-9" tabindex="-1"></a><span class="do">## [90m 6[39m cibersort.T.cells.CD4.memory.re… [90m&lt;tibble [48 × 9]&gt;[39m                       9.25</span></span>
<span id="cb54-10"><a href="#cb54-10" tabindex="-1"></a><span class="do">## [90m 7[39m cibersort.T.cells.CD4.memory.ac… [90m&lt;tibble [48 × 9]&gt;[39m                      10.9 </span></span>
<span id="cb54-11"><a href="#cb54-11" tabindex="-1"></a><span class="do">## [90m 8[39m cibersort.T.cells.follicular.he… [90m&lt;tibble [48 × 9]&gt;[39m                      15.7 </span></span>
<span id="cb54-12"><a href="#cb54-12" tabindex="-1"></a><span class="do">## [90m 9[39m cibersort.T.cells.regulatory..T… [90m&lt;tibble [48 × 9]&gt;[39m                       7.30</span></span>
<span id="cb54-13"><a href="#cb54-13" tabindex="-1"></a><span class="do">## [90m10[39m cibersort.T.cells.gamma.delta    [90m&lt;tibble [48 × 9]&gt;[39m                      15.3 </span></span>
<span id="cb54-14"><a href="#cb54-14" tabindex="-1"></a><span class="do">## [90m# ℹ 12 more rows[39m</span></span>
<span id="cb54-15"><a href="#cb54-15" tabindex="-1"></a><span class="do">## [90m# ℹ abbreviated name: ¹​.low_cellularity_expected[39m</span></span>
<span id="cb54-16"><a href="#cb54-16" tabindex="-1"></a><span class="do">## [90m# ℹ 3 more variables: .high_cellularity_expected &lt;dbl&gt;, pvalue &lt;dbl&gt;,[39m</span></span>
<span id="cb54-17"><a href="#cb54-17" tabindex="-1"></a><span class="do">## [90m#   plot &lt;list&gt;[39m</span></span></code></pre></div>
<p>Plot Kaplan-Meier curves</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_stratified</span><span class="op">$</span><span class="va">plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-19-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="cluster-samples">Cluster <code>samples</code>
<a class="anchor" aria-label="anchor" href="#cluster-samples"></a>
</h2>
<p>We may want to cluster our data (e.g., using k-means sample-wise). <code>cluster_elements</code> takes as arguments a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and returns a tibble with additional columns for the cluster annotation. At the moment only k-means clustering is supported, the plan is to introduce more clustering methods.</p>
<p><strong>k-means</strong></p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.cluster</span> <span class="op">=</span> <span class="va">counts_SE.norm.MDS</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/cluster_elements-methods.html">cluster_elements</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"kmeans"</span>, centers <span class="op">=</span> <span class="fl">2</span>, action<span class="op">=</span><span class="st">"get"</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_m_log</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">count_m</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">k</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">count_m_log</span>, iter.max <span class="op">=</span> <span class="fl">1000</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="va">cluster</span> <span class="op">=</span> <span class="va">k</span><span class="op">$</span><span class="va">cluster</span></span>
<span></span>
<span><span class="va">cluster</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">tibble_counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">tibble_counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cell.type"</span>, <span class="st">"Dim1"</span>, <span class="st">"Dim2"</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>We can add cluster annotation to the MDS dimension reduced data set and plot.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">counts_SE.norm.cluster</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">`Dim1`</span>, y<span class="op">=</span><span class="va">`Dim2`</span>, color<span class="op">=</span><span class="va">`cluster_kmeans`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/plot_cluster-1.png"><!-- --></p>
<p><strong>SNN</strong></p>
<p>Matrix package (v1.3-3) causes an error with Seurat::FindNeighbors used in this method. We are trying to solve this issue. At the moment this option in unaviable.</p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.SNN</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE.norm.tSNE</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/cluster_elements-methods.html">cluster_elements</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"SNN"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span><span class="va">count_m</span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span></span>
<span>    <span class="va">snn</span>, display.progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    num.cores<span class="op">=</span><span class="fl">4</span>, do.par <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">snn</span>, selection.method <span class="op">=</span> <span class="st">"vst"</span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">snn</span>, selection.method <span class="op">=</span> <span class="st">"vst"</span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span><span class="va">snn</span>, npcs <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span><span class="va">snn</span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span><span class="va">snn</span>, method <span class="op">=</span> <span class="st">"igraph"</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="va">snn</span> <span class="op">=</span> <span class="va">snn</span><span class="op">[[</span><span class="st">"seurat_clusters"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">snn</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">=</span> <span class="va">tibble_counts</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">tibble_counts</span><span class="op">$</span><span class="va">sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">snn</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cell.type"</span>, <span class="st">"Dim1"</span>, <span class="st">"Dim2"</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.SNN</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"tSNE"</span><span class="op">)</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">counts_SE.norm.SNN</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gather</span><span class="op">(</span><span class="va">source</span>, <span class="va">Call</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster_SNN"</span>, <span class="st">"Call"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/distinct-methods.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">`tSNE1`</span>, y <span class="op">=</span> <span class="va">`tSNE2`</span>, color<span class="op">=</span><span class="va">Call</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="va">source</span><span class="op">)</span> <span class="op">+</span> <span class="va">my_theme</span></span>
<span></span>
<span></span>
<span><span class="co"># Do differential transcription between clusters</span></span>
<span><span class="va">counts_SE.norm.SNN</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/mutate-methods.html">mutate</a></span><span class="op">(</span>factor_of_interest <span class="op">=</span> <span class="va">`cluster_SNN`</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/test_differential_abundance-methods.html">test_differential_abundance</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span> <span class="va">factor_of_interest</span>,</span>
<span>    action<span class="op">=</span><span class="st">"get"</span></span>
<span>   <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="drop-redundant-transcripts">Drop <code>redundant</code> transcripts<a class="anchor" aria-label="anchor" href="#drop-redundant-transcripts"></a>
</h2>
<p>We may want to remove redundant elements from the original data set (e.g., samples or transcripts), for example if we want to define cell-type specific signatures with low sample redundancy. <code>remove_redundancy</code> takes as arguments a tibble, column names (as symbols; for <code>sample</code>, <code>transcript</code> and <code>count</code>) and returns a tibble with redundant elements removed (e.g., samples). Two redundancy estimation approaches are supported:</p>
<ul>
<li>removal of highly correlated clusters of elements (keeping a representative) with method=“correlation”</li>
<li>removal of most proximal element pairs in a reduced dimensional space.</li>
</ul>
<p><strong>Approach 1</strong></p>
<div class="column-left">
<p>TidyTranscriptomics</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.non_redundant</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE.norm.MDS</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/remove_redundancy-methods.html">remove_redundancy</a></span><span class="op">(</span>    method <span class="op">=</span> <span class="st">"correlation"</span> <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="do">## Getting the 8513 most variable genes</span></span></code></pre></div>
</div>
<div class="column-right">
<p>Standard procedure (comparative purpose)</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/widyr" class="external-link">widyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">.data.correlated</span> <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/pairwise_cor.html" class="external-link">pairwise_cor</a></span><span class="op">(</span></span>
<span>        <span class="va">counts</span>,</span>
<span>        <span class="va">sample</span>,</span>
<span>        <span class="va">transcript</span>,</span>
<span>        <span class="va">rc</span>,</span>
<span>        sort <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        diag <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        upper <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/filter-methods.html">filter</a></span><span class="op">(</span><span class="va">correlation</span> <span class="op">&gt;</span> <span class="va">correlation_threshold</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/distinct-methods.html">distinct</a></span><span class="op">(</span><span class="va">item1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/rename-methods.html">rename</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">.element</span> <span class="op">:=</span> <span class="va">item1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return non redudant data frame</span></span>
<span><span class="va">counts</span> <span class="op">|&gt;</span> <span class="fu">anti_join</span><span class="op">(</span><span class="va">.data.correlated</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">spread</span><span class="op">(</span><span class="va">sample</span>, <span class="va">rc</span>, <span class="op">-</span> <span class="va">transcript</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/dplyr-methods.html">left_join</a></span><span class="op">(</span><span class="va">annotation</span><span class="op">)</span></span></code></pre></div>
</div>
<div style="clear:both;">

</div>
<p>We can visualise how the reduced redundancy with the reduced dimentions look like</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.non_redundant</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">`Dim1`</span>, y<span class="op">=</span><span class="va">`Dim2`</span>, color<span class="op">=</span><span class="va">`Cell.type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/plot_drop-1.png"><!-- --></p>
<p><strong>Approach 2</strong></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.non_redundant</span> <span class="op">=</span></span>
<span>    <span class="va">counts_SE.norm.MDS</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/remove_redundancy-methods.html">remove_redundancy</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"reduced_dimensions"</span>,</span>
<span>    Dim_a_column <span class="op">=</span> <span class="va">`Dim1`</span>,</span>
<span>    Dim_b_column <span class="op">=</span> <span class="va">`Dim2`</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can visualise MDS reduced dimensions of the samples with the closest pair removed.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE.norm.non_redundant</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="reference/pivot_sample-methods.html">pivot_sample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">`Dim1`</span>, y<span class="op">=</span><span class="va">`Dim2`</span>, color<span class="op">=</span><span class="va">`Cell.type`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">my_theme</span></span></code></pre></div>
<p><img src="reference/figures/plot_drop2-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="other-useful-wrappers">Other useful wrappers<a class="anchor" aria-label="anchor" href="#other-useful-wrappers"></a>
</h2>
<p>The above wrapper streamline the most common processing of bulk RNA sequencing data. Other useful wrappers are listed above.</p>
</div>
<div class="section level2">
<h2 id="from-bamsam-to-tibble-of-gene-counts">From BAM/SAM to tibble of gene counts<a class="anchor" aria-label="anchor" href="#from-bamsam-to-tibble-of-gene-counts"></a>
</h2>
<p>We can calculate gene counts (using FeatureCounts; Liao Y et al., 10.1093/nar/gkz114) from a list of BAM/SAM files and format them into a tidy structure (similar to counts).</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">=</span> <span class="fu"><a href="reference/tidybulk_SAM_BAM-methods.html">tidybulk_SAM_BAM</a></span><span class="op">(</span></span>
<span>    <span class="va">file_names</span>,</span>
<span>    genome <span class="op">=</span> <span class="st">"hg38"</span>,</span>
<span>    isPairedEnd <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    requireBothEndsMapped <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    checkFragLength <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    useMetaFeatures <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="from-ensembl-ids-to-gene-symbol-ids">From ensembl IDs to gene symbol IDs<a class="anchor" aria-label="anchor" href="#from-ensembl-ids-to-gene-symbol-ids"></a>
</h2>
<p>We can add gene symbols from ensembl identifiers. This is useful since different resources use ensembl IDs while others use gene symbol IDs. This currently works for human and mouse.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_ensembl</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/ensembl_to_symbol-methods.html">ensembl_to_symbol</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="do">## [90m# A tibble: 119 × 8[39m</span></span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a><span class="do">##    ens   iso   `read count` sample cases_0_project_dise…¹ cases_0_samples_0_sa…²</span></span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a><span class="do">##    [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m        [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m  [3m[90m&lt;chr&gt;[39m[23m                  [3m[90m&lt;chr&gt;[39m[23m                 </span></span>
<span id="cb70-4"><a href="#cb70-4" tabindex="-1"></a><span class="do">## [90m 1[39m ENSG… 13             144 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-5"><a href="#cb70-5" tabindex="-1"></a><span class="do">## [90m 2[39m ENSG… 13              72 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-6"><a href="#cb70-6" tabindex="-1"></a><span class="do">## [90m 3[39m ENSG… 13               0 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-7"><a href="#cb70-7" tabindex="-1"></a><span class="do">## [90m 4[39m ENSG… 13            [4m1[24m099 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-8"><a href="#cb70-8" tabindex="-1"></a><span class="do">## [90m 5[39m ENSG… 13              11 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-9"><a href="#cb70-9" tabindex="-1"></a><span class="do">## [90m 6[39m ENSG… 13               2 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-10"><a href="#cb70-10" tabindex="-1"></a><span class="do">## [90m 7[39m ENSG… 13               3 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-11"><a href="#cb70-11" tabindex="-1"></a><span class="do">## [90m 8[39m ENSG… 13            [4m2[24m678 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-12"><a href="#cb70-12" tabindex="-1"></a><span class="do">## [90m 9[39m ENSG… 13             751 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-13"><a href="#cb70-13" tabindex="-1"></a><span class="do">## [90m10[39m ENSG… 13               1 TARGE… Acute Myeloid Leukemia Primary Blood Derived…</span></span>
<span id="cb70-14"><a href="#cb70-14" tabindex="-1"></a><span class="do">## [90m# ℹ 109 more rows[39m</span></span>
<span id="cb70-15"><a href="#cb70-15" tabindex="-1"></a><span class="do">## [90m# ℹ abbreviated names: ¹​cases_0_project_disease_type,[39m</span></span>
<span id="cb70-16"><a href="#cb70-16" tabindex="-1"></a><span class="do">## [90m#   ²​cases_0_samples_0_sample_type[39m</span></span>
<span id="cb70-17"><a href="#cb70-17" tabindex="-1"></a><span class="do">## [90m# ℹ 2 more variables: transcript &lt;chr&gt;, ref_genome &lt;chr&gt;[39m</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="from-gene-symbol-to-gene-description-gene-name-in-full">From gene symbol to gene description (gene name in full)<a class="anchor" aria-label="anchor" href="#from-gene-symbol-to-gene-description-gene-name-in-full"></a>
</h2>
<p>We can add gene full name (and in future description) from symbol identifiers. This currently works for human and mouse.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_SE</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="reference/describe_transcript-methods.html">describe_transcript</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">feature</span>, <span class="va">description</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="do">## Warning in is_sample_feature_deprecated_used(.data, .cols):</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a><span class="do">## tidySummarizedExperiment says: from version 1.3.1, the special columns</span></span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a><span class="do">## including sample/feature id (colnames(se), rownames(se)) has changed to</span></span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a><span class="do">## ".sample" and ".feature". This dataset is returned with the old-style</span></span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a><span class="do">## vocabulary (feature and sample), however we suggest to update your workflow to</span></span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a><span class="do">## reflect the new vocabulary (.feature, .sample)</span></span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a><span class="do">## [90m# A SummarizedExperiment-tibble abstraction: 408,624 × 10[39m</span></span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a><span class="do">## [90m# [90mFeatures=8513 | Samples=48 | Assays=count[0m[39m</span></span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a><span class="do">##    feature  sample     count Cell.type time  condition batch factor_of_interest</span></span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a><span class="do">##    [3m[90m&lt;chr&gt;[39m[23m    [3m[90m&lt;chr&gt;[39m[23m      [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;lgl&gt;[39m[23m     [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;lgl&gt;[39m[23m             </span></span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a><span class="do">## [90m 1[39m A1BG     SRR1740034   153 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-13"><a href="#cb72-13" tabindex="-1"></a><span class="do">## [90m 2[39m A1BG-AS1 SRR1740034    83 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-14"><a href="#cb72-14" tabindex="-1"></a><span class="do">## [90m 3[39m AAAS     SRR1740034   868 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-15"><a href="#cb72-15" tabindex="-1"></a><span class="do">## [90m 4[39m AACS     SRR1740034   222 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-16"><a href="#cb72-16" tabindex="-1"></a><span class="do">## [90m 5[39m AAGAB    SRR1740034   590 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-17"><a href="#cb72-17" tabindex="-1"></a><span class="do">## [90m 6[39m AAMDC    SRR1740034    48 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-18"><a href="#cb72-18" tabindex="-1"></a><span class="do">## [90m 7[39m AAMP     SRR1740034  [4m1[24m257 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-19"><a href="#cb72-19" tabindex="-1"></a><span class="do">## [90m 8[39m AANAT    SRR1740034   284 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-20"><a href="#cb72-20" tabindex="-1"></a><span class="do">## [90m 9[39m AAR2     SRR1740034   379 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-21"><a href="#cb72-21" tabindex="-1"></a><span class="do">## [90m10[39m AARS2    SRR1740034   685 b_cell    0 d   TRUE      0     TRUE              </span></span>
<span id="cb72-22"><a href="#cb72-22" tabindex="-1"></a><span class="do">## [90m# ℹ 40 more rows[39m</span></span>
<span id="cb72-23"><a href="#cb72-23" tabindex="-1"></a><span class="do">## [90m# ℹ 2 more variables: description &lt;chr&gt;, gene_name &lt;chr&gt;[39m</span></span></code></pre></div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://www.bioconductor.org/packages/tidybulk" class="external-link">View on Bioconductor</a></li>
<li><a href="https://github.com/stemangiola/tidybulk/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/stemangiola/tidybulk/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tidybulk</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Stefano Mangiola <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#maturing" class="external-link"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="Lifecycle:maturing"></a></li>
<li><a href="https://github.com/stemangiola/tidybulk/actions" class="external-link"><img src="https://github.com/stemangiola/tidybulk/workflows/R-CMD-check-bioc/badge.svg" alt="R build status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Stefano Mangiola.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
